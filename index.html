<!DOCTYPE html>
<html>
    <head>
        <title>Audio Recorder</title>
    </head>
    <body>
        <button id="start">Start Recording</button>
        <p id="status"></p>
        <audio id="player" controls></audio>

        <script>
            var button = document.getElementById('start');
            var status = document.getElementById('status');
            var player = document.getElementById('player');

            button.onclick = function() {
                status.textContent = 'Recording...';
                navigator.mediaDevices.getUserMedia({audio: true})
                    .then(stream => {
                        status.textContent = 'Asking for permission...';
                        const mediaRecorder = new MediaRecorder(stream);
                        mediaRecorder.start();

                        const audioChunks = [];
                        mediaRecorder.addEventListener("dataavailable", event => {
                            audioChunks.push(event.data);
                        });

                        mediaRecorder.addEventListener("stop", () => {
                            status.textContent = 'Finished recording, now playing back...';
                            const audioBlob = new Blob(audioChunks);
                            const audioUrl = URL.createObjectURL(audioBlob);
                            player.src = audioUrl;

                            if (audioUrl) {
                                console.log("Audio URL created: " + audioUrl);
                            } else {
                                console.log("Failed to create audio URL");
                            }

                            player.onloadedmetadata = function() {
                                console.log("Audio metadata loaded");
                                player.play();
                            };

                            player.onerror = function(e) {
                                console.log("Error playing audio: ", e);
                            };
                        });

                        setTimeout(() => {
                            status.textContent = 'Permission granted, now stopping...';
                            mediaRecorder.stop();
                        }, 3000);
                    });
            };
        </script>
    </body>
</html>
